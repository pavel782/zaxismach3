const MachMsgTypeOK = 0Dim mach3AxisCurPosStartIndex, mach3CommonVariablesStartIndex, mach3AxisVariablesStartIndex, spindleSwitch, enablePluginmach3AxisCurPosStartIndex = {2}mach3CommonVariablesStartIndex = {3}mach3AxisVariablesStartIndex = {4}spindleSwitch = GetVar(mach3CommonVariablesStartIndex + 6)enablePlugin = GetVar(mach3CommonVariablesStartIndex + 7)if (spindleSwitch = 1 or enablePlugin <> 1) then  SetVar(mach3CommonVariablesStartIndex + 6, 0)  DoSpinCW()else  Dim axis, stepsPerMm, speed, curPosCPeriod, estop, moveTimeout, droNumber, droMultiplier, curLocation, newLocation, newSpeed, speedToSend, cacheKey  Dim axisCount, axisVariablesCount, base_i, axis_i  Dim errMsg, curMovePos, prevMovePos, calculatedMoveTime  axisCount = {0}  axisVariablesCount = {1}  axis_i = GetVar(mach3CommonVariablesStartIndex)  base_i = mach3AxisVariablesStartIndex + axis_i * axisVariablesCount  axis = axis_i  stepsPerMm = GetVar(base_i + 1)  speed = GetVar(base_i + 2)  curPosCheckPeriod = GetVar(base_i + 3)  estop = GetVar(base_i + 4)  moveTimeout = GetVar(base_i + 5)  droNumber = GetVar(base_i + 6)  droMultiplier = GetVar(base_i + 7)  curLocation = GetVar(base_i + 8)  newLocation = GetVar(mach3CommonVariablesStartIndex + 1)  newSpeed = GetVar(mach3CommonVariablesStartIndex + 2)    Set cacheKey = "cacheKey00"  if (newSpeed > 0) then     speedToSend = newSpeed  else     speedToSend = speed  end if  Dim serialPortAx  Set serialPortAx = CreateObject("SerialPortAxControl.SerialPortAxControl")  serialPortAx.SetCacheKey cacheKey  calculatedMoveTime = 60000 * Abs(newLocation - curLocation) / speedToSend  if (moveTimeout > 0) then    moveTimeout = moveTimeout + calculatedMoveTime  end if   if (curPosCheckPeriod = 0 or calculatedMoveTime < 2000) then    Set errMsg = serialPortAx.MoveAxis(axis, newLocation, speedToSend, true, moveTimeout)    if (IsNull(errMsg) or (errMsg <> "OK")) then	  DoOEMButton 1021      MachMsg(errMsg,  "Failed motor axis move", MachMsgTypeOK)    else      SetOEMDRO(droNumber, newLocation * droMultiplier)    end if  else    Set errMsg = serialPortAx.MoveAxis(axis, newLocation, speedToSend, false, moveTimeout)    curMovePos = curLocation    prevMovePos = curLocation    while (errMsg = "OK" and curMovePos < 10000)      Sleep curPosCheckPeriod      curMovePos = serialPortAx.GetCurMovingAxisPos(axis)      if (curMovePos < 10000) then        SetOEMDRO(droNumber, curMovePos * droMultiplier)          prevMovePos = curMovePos        end if        if (curMovePos = 10000) then          errMsg =  "OK"        end if        if (curMovePos = 10001) then          errMsg =  "Timeout"        end if        if (curMovePos = 10002) then          errMsg =  "Error"        end if    wend    if (curMovePos = 10000) then      SetOEMDRO(droNumber, newLocation * droMultiplier)    end if  end if  if (errMsg <> "OK" and estop = 1) then        DoOEMButton(1021)    MachMsg(errMsg,  "Failed motor axis move", MachMsgTypeOK)  end if  if (errMsg <> "OK" and estop <> 1) then        MachMsg(errMsg,  "Failed motor axis move", MachMsgTypeOK)  end if      SetVar(base_i + 8, newLocation)  SetVar(mach3AxisCurPosStartIndex + axis_i, newLocation)  SetVar(mach3CommonVariablesStartIndex + 1, -1)  SetVar(mach3CommonVariablesStartIndex + 2, -1)end if